<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coronavirus statistics in Morocco</title>
    <script src="Chart.min.js"></script>
    <script src="jquery.min.js"></script>
</head>
<body>
    <div id='time_graph'>
        <h2>Statistics by time </h2>
        <canvas id="time" width="800" height="400"></canvas>
    </div>
    <script>
        //fetch data from local api
        $.getJSON('http://localhost:3000/api/time',function(data){

            let jsondata = data;
            let dates = []; //for time points // x axis
            let active_cases = []; //for datapoints // y axis
            let recoveries = []; //for datapoints // y axis
            let deaths = []; //for datapoints // y axis
            
            jsondata.forEach(line => {
                //fill 'dates' array with all dates
                dates.push(line["Dates / التواريخ"])

                //fill 'active_cases' array with objects {x:date,y:number of active cases}
                active_cases.push(
                    {
                        x: line["Dates / التواريخ"],
                        y: line["Cases / الحالات"]
                    });

                //fill 'deaths' array with objects {x:date,y:number of deaths}
                deaths.push(
                    {
                        x: line["Dates / التواريخ"],
                        y: line["Deaths / الوفيات"]
                    });

                //fill 'recoveries' array with objects {x:date,y:number of recoveries}
                recoveries.push(
                    {
                        x: line["Dates / التواريخ"],
                        y: line["Recovered / تعافى"]
                    });
            });

            //select canvas by id
            var ctx = document.getElementById('time');
            //init chart
            var chart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: [ // Date Objects
					newDate(0),
					newDate(1),
					newDate(2),
					newDate(3),
					newDate(4),
					newDate(5),
					newDate(6)
				],
				datasets: [{
					label: 'My First dataset',
					backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
					borderColor: window.chartColors.red,
					fill: false,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}, {
					label: 'My Second dataset',
					backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
					borderColor: window.chartColors.blue,
					fill: false,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}, {
					label: 'Dataset with point data',
					backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
					borderColor: window.chartColors.green,
					fill: false,
					data: [{
						x: newDateString(0),
						y: randomScalingFactor()
					}, {
						x: newDateString(5),
						y: randomScalingFactor()
					}, {
						x: newDateString(7),
						y: randomScalingFactor()
					}, {
						x: newDateString(15),
						y: randomScalingFactor()
					}],
				}]
			},
			options: {
				title: {
					text: 'Chart.js Time Scale'
				},
				scales: {
					xAxes: [{
						type: 'time',
						time: {
							parser: timeFormat,
							// round: 'day'
							tooltipFormat: 'll HH:mm'
						},
						scaleLabel: {
							display: true,
							labelString: 'Date'
						}
					}],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'value'
						}
					}]
				},
			}
		});
    </script>

    <div id='regions_graph'>
        <h2>Statistics by regions </h2>
        <canvas id="regions" width="800" height="400"></canvas>
    </div>
    <script>
        //fetch data from local api
        $.getJSON('http://localhost:3000/api/regions',function(data){

            let jsondata = data;
            let labels = []; //for labels // x axis
            let active_cases = []; //for datapoints // y axis
            let recoveries = []; //for datapoints // y axis
            let deaths = []; //for datapoints // y axis
            
            //sort data by number of active cases 
            var sorted = jsondata.slice(0);
            sorted.sort(function(a,b) {
                return Number(b["Active Cases / الحالات النشطة"]) - Number(a["Active Cases / الحالات النشطة"]);
            });
            jsondata = sorted;

            //fill 'labels' array with all region names
            jsondata.forEach(line => {
                labels.push(line["Region / الجهة"]);
            });
            //fill 'active_cases' array with number of active cases per region
            jsondata.forEach(line => {
                active_cases.push(line["Active Cases / الحالات النشطة"]);
            });
            //fill 'deaths' array with number of deaths per region
            jsondata.forEach(line => {
                deaths.push(line["Total Deaths / إجمالي الوفيات"]);
            });
            //fill 'recoveries' array with number of recoveries per region
            jsondata.forEach(line => {
                recoveries.push(line["Total Recovered / إجمالي المعافين"]);
            });

            //select canvas by id
            var ctx = document.getElementById('regions');
            //init chart
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels, // Regions names
                    datasets: [
                        {
                            label: 'Number of active cases',
                            data: active_cases,
                            backgroundColor: 'rgba(255,0,0,.5)',
                            borderWidth: 2
                        },
                        {
                            label: 'Total recoveries',
                            data: recoveries,
                            backgroundColor: 'rgba(0,255,0,.5)',
                            borderWidth: 2
                        },
                        {
                            label: 'Total deaths',
                            data: deaths,
                            backgroundColor: 'rgba(50,0,0,.5)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        });
    </script>

    <div id='cities_graph'>
        <h2>Statistics by cities </h2>
        <canvas id="cities" width="800" height="400"></canvas>
    </div>
    <script>
        //fetch data from local api
        $.getJSON('http://localhost:3000/api/cities',function(data){

            let jsondata = data;
            let labels = []; //for labels // x axis
            let active_cases = []; //for datapoints // y axis
            let recoveries = []; //for datapoints // y axis
            let deaths = []; //for datapoints // y axis
            
            //sort data by number of active cases 
            var sorted = jsondata.slice(0);
            sorted.sort(function(a,b) {
                return Number(b["Active Cases / الحالات النشطة"]) - Number(a["Active Cases / الحالات النشطة"]);
            });
            jsondata = sorted;

                // Since a lot of cities have zero cases,
                // we'll ignore them until their stats change

            jsondata.forEach(line => {
                if (Number(line['Active Cases / الحالات النشطة']) +
                    Number(line['Total Deaths / إجمالي الوفيات']) +
                    Number(line['Total Recovered / إجمالي المعافين']) != 0)
                {
                    //fill 'labels' array with all city names
                    labels.push(line["City / المدينة"])

                    //fill 'active_cases' array with number of active cases per region
                    active_cases.push(line["Active Cases / الحالات النشطة"]);

                    //fill 'deaths' array with number of deaths per region
                    deaths.push(line["Total Deaths / إجمالي الوفيات"]);

                    //fill 'recoveries' array with number of recoveries per region
                    recoveries.push(line["Total Recovered / إجمالي المعافين"]);
                }
            });

            //select canvas by id
            var ctx = document.getElementById('cities');
            //init chart
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels, // cities names
                    datasets: [
                        {
                            label: 'Number of active cases',
                            data: active_cases,
                            backgroundColor: 'rgba(255,0,0,.5)',
                            borderWidth: 2
                        },
                        {
                            label: 'Total recoveries',
                            data: recoveries,
                            backgroundColor: 'rgba(0,255,0,.5)',
                            borderWidth: 2
                        },
                        {
                            label: 'Total deaths',
                            data: deaths,
                            backgroundColor: 'rgba(50,0,0,.5)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: false,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        });
    </script>
</body>
</html>

